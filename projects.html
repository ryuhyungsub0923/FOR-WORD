<!-- =========================================================
FILE: projects-list.html  (Projects 리스트 전용)
========================================================= -->
<!doctype html>
<html lang="ko" class="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FOR:WORD — Projects (List)</title>

  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css"/>

  <!-- Tailwind (dev only) -->
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { fontFamily: { sans: ['Pretendard','system-ui','sans-serif'] } } }
    };
  </script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>

  <style>
    :root{
      /* ====== 레이아웃 토큰 ====== */
      --page-max: 1450px;  /* My Projects 전체 최대 가로폭 */
      --grid-gap: 35px;    /* 기본 카드 간격 */

      /* 컬럼별 카드 자체 폭 */
      --col1-card-w: 260px; /* 1열 */
      --col2-card-w: 260px; /* 2열 */
      --col3-card-w: 260px; /* 3열 */
      --col4-card-w: 260px; /* 4열 */

      /* 색/치수 토큰 */
      --sb-nav-top: rgba(30,31,31,0.9);
      --sb-nav-bottom: #848C95;
      --sb-main-top: #2C2C2C;
      --sb-main-bottom: #929292;

      --sidebar-w: 212px;
      --sidebar-w-collapsed: 68px;
      --mobile-nav-h: 64px;

      --status-color:#8A8CD9;

      /* scrollbar */
      --scroll-thumb: rgba(55,65,81,0.45);
      --scroll-thumb-hover: rgba(55,65,81,0.65);

      /* 리스트: 새 프로젝트 카드 높이 기본값(프로젝트 없을 때) */
      --new-card-min-h: 220px;
    }

    body{ overflow:hidden; font-family:Pretendard, system-ui, sans-serif; letter-spacing:-0.02em; }
    .tap-highlight-clear{ -webkit-tap-highlight-color: rgba(0,0,0,0); }

    /* ── LEFT SIDEBAR ── */
    .nav-label{ font-size:14px; font-weight:400; line-height:1.3; letter-spacing:-0.02em; color:rgba(255,255,255,0.7); }
    .nav-label-active{ color:#fff; font-weight:500; }

    .sidebar{
      width:var(--sidebar-w);
      background: linear-gradient(to bottom, var(--sb-nav-top) 0%, var(--sb-nav-bottom) 100%);
      transition: width 0.18s ease;
    }
    .sidebar[data-collapsed="true"]{ width:var(--sidebar-w-collapsed); }

    .brand-text{ font-size:18px; font-weight:600; line-height:1.2; letter-spacing:-0.02em; color:#fff; white-space:nowrap; }
    .sidebar[data-collapsed="true"] .brand-text{ display:none; }

    .brand-wrapper{ display:flex; align-items:center; justify-content:space-between; width:100%; position:relative; }
    .brand-left{ display:flex; align-items:center; gap:12px; cursor:pointer; width:auto; }
    .sidebar[data-collapsed="true"] .brand-left{ justify-content:center; width:100%; gap:0 !important; }

    .logo-wrapper{ flex-shrink:0; width:32px; height:32px; border-radius:6px; background-color:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .logo-wrapper img{ width:100%; height:100%; object-fit:contain; }
    .sidebar[data-collapsed="true"] .logo-wrapper{ display:none; }

    .expand-icon-wrapper{ flex-shrink:0; width:32px; height:32px; border-radius:6px; background-color:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); display:none; align-items:center; justify-content:center; }
    .sidebar[data-collapsed="true"] .expand-icon-wrapper{ display:flex; }

    .brand-right{ flex-shrink:0; display:flex; align-items:center; justify-content:center; }
    .sidebar[data-collapsed="true"] .brand-right{ display:none; }

    .collapse-btn{ width:28px; height:28px; border-radius:6px; display:flex; align-items:center; justify-content:center; background-color:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); transition:background-color .12s ease; cursor:pointer; }
    .collapse-btn:hover{ background-color:rgba(255,255,255,0.15); }
    .collapse-icon{ transition:transform .18s ease; }
    .sidebar[data-collapsed="true"] .collapse-icon{ transform:rotate(180deg); }

    .sidebar-nav-container{ display:flex; flex-direction:column; flex-grow:1; padding:24px 16px; }
    .sidebar[data-collapsed="true"] .sidebar-nav-container{ padding-left:10px; padding-right:10px; }

    .sidebar-nav-btn{
      width:180px; height:48px; display:flex; align-items:center; border-radius:0.5rem;
      padding:0 12px; gap:10px; text-align:left; transition:background-color .12s ease,color .12s ease;
      text-decoration:none; color:inherit;
    }
    .sidebar-nav-btn-active{ background-color:rgba(255,255,255,0.1); }
    .sidebar-nav-btn:hover{ background-color:rgba(255,255,255,0.1); }

    .sidebar[data-collapsed="true"] .sidebar-nav-btn{ width:48px; justify-content:center; gap:0; padding-left:0; padding-right:0; }
    .sidebar[data-collapsed="true"] .sidebar-nav-btn span.nav-label{ display:none; }

    .sidebar-divider{ width:100%; border-top:1px solid rgba(255,255,255,0.15); margin:16px 0; }
    .sidebar[data-collapsed="true"] .sidebar-divider{ margin:12px 0; }

    .profile-wrap{ padding:16px; }
    .sidebar[data-collapsed="true"] .profile-wrap{ padding-left:10px; padding-right:10px; }

    .profile-row{ display:flex; align-items:center; gap:12px; }
    .profile-icon{ width:32px; height:32px; border-radius:6px; background-color:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .profile-icon img{ width:100%; height:100%; object-fit:contain; }
    .profile-meta{ display:flex; flex-direction:column; line-height:1.2; }
    .sidebar[data-collapsed="true"] .profile-meta{ display:none; }

    .profile-border{ border-top:1px solid rgba(255,255,255,0.1); color:rgba(255,255,255,0.6); font-size:12px; }

    .main-bg{ background:linear-gradient(to bottom, var(--sb-main-top) 0%, var(--sb-main-bottom) 100%); }
    .mobile-nav-bg{ background:linear-gradient(to bottom, var(--sb-nav-top) 0%, var(--sb-nav-bottom) 100%); }
    .mobile-nav-btn{ display:flex; flex-direction:column; align-items:center; gap:4px; font-size:11px; color:rgba(255,255,255,0.7); }
    .mobile-nav-btn-active{ color:#fff; }

    /* ── main layout ── */
    .page-inner{ max-width: var(--page-max); width:100%; display:flex; flex-direction:column; }
    .projects-wrapper{ display:flex; flex-direction:row; align-items:flex-start; gap:32px; width:100%; }
    .right-region{ flex:1 1 auto; min-width:0; display:flex; flex-direction:column; }
    .right-header .hero-title{ color:#fff; font-size:32px; font-weight:700; letter-spacing:1px; }

    /* board */
    .board-shell{
      position:relative; display:flex; flex-direction:column;
      background:#FFFFFF; border-radius:8px; border:1px solid rgba(0,0,0,0.08);
      box-shadow:0 24px 60px rgba(0,0,0,0.4);
      height:800px; margin-top:32px; padding:20px 0 20px 20px;
      color:#000; overflow:hidden;
    }
    .projects-scroller{
      position:relative; flex:1 1 auto; min-height:0;
      overflow-y:auto; overflow-x:hidden; overscroll-behavior:contain; padding-bottom:8px;
      scrollbar-width:thin; scrollbar-color:var(--scroll-thumb) transparent;
    }
    .projects-scroller::-webkit-scrollbar{ width:6px; }
    .projects-scroller::-webkit-scrollbar-track{ background:transparent; }
    .projects-scroller::-webkit-scrollbar-thumb{ background:var(--scroll-thumb); border-radius:9999px; }
    .projects-scroller::-webkit-scrollbar-thumb:hover{ background:var(--scroll-thumb-hover); }

    .projects-row{
      position:relative; display:grid;
      grid-template-columns: var(--col1-card-w) var(--col2-card-w) var(--col3-card-w) var(--col4-card-w);
      column-gap: var(--grid-gap);
      row-gap: var(--grid-gap);
      width:100%; align-items:start; padding-right:20px;
      justify-content: start;
    }

    /* 공통 카드 */
    .proj-card{
      background:#fff; border:1px solid rgba(0,0,0,0.07);
      border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,0.06);
      padding:16px; color:#000; display:flex; flex-direction:column; gap:14px;
      position:relative; z-index:1; min-width:0;
    }
    .proj-toprow{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    .proj-title{ font-weight:700; font-size:13px; color:#000; letter-spacing:-0.02em; word-break:break-word; }
    .proj-toprow .proj-texts{ flex:1 1 auto; min-width:0; }
    .proj-iconwrap{
      width:56px; height:56px; border-radius:9999px; background:#2E2F9F; color:#fff;
      display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:500; line-height:1; flex-shrink:0;
      cursor:pointer; user-select:none; position:relative;
    }
    .proj-iconwrap .emoji{ font-size:30px; line-height:1; transform: translateY(1px); }
    .proj-status-row{ display:flex; align-items:center; gap:8px; font-size:13px; justify-content:flex-end; }
    .proj-status-dot{ width:8px; height:8px; border-radius:9999px; background:var(--status-color); }
    .proj-status-text{ color:var(--status-color); font-weight:500; }
    .proj-progressbar{ width:100%; height:4px; border-radius:2px; background:#efefef; }
    .proj-progress-inner{ height:100%; border-radius:2px; background:var(--status-color); width:0%; }
    .proj-footer-row{ display:flex; align-items:flex-start; justify-content:space-between; gap:8px; font-size:13px; color:#000; }
    .proj-percent{ font-weight:500; color:#000; white-space:nowrap; }
    .proj-hint{ font-size:11px; color:rgba(0,0,0,0.45); }

    /* 리스트: 프로젝트 카드(1번 박스와 동일 폭) */
    .list-card{ width: var(--col1-card-w); max-width:100%; cursor:grab; }
    .list-card.dragging{ opacity:.6; transform:scale(0.98); cursor:grabbing; }
    .list-card.drop-target{ outline:2px dashed #6B7280; }

    /* 리스트: 삭제 버튼 — 'x' 텍스트만 */
    .card-del-btn{
      position:absolute; top:6px; right:8px;
      background:transparent; border:none; padding:0;
      color:#9CA3AF; font-size:16px; line-height:1; font-weight:700;
      cursor:pointer; z-index:2;
    }
    .card-del-btn:hover{ color:#111827; transform:scale(1.05); }

    /* 리스트: 새 프로젝트 카드 (점선 테두리) */
    .new-proj-card{
      width: var(--col1-card-w);
      max-width: 100%;
      min-height: var(--new-card-min-h);
      border: 2px dashed #9CA3AF !important;
      background:#fff;
      box-shadow:none;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      text-align:center;
    }
    .new-proj-card .plus{ font-size:36px; line-height:1; color:#9CA3AF; }
    .new-proj-card .label{ font-size:13px; font-weight:700; color:#9CA3AF; }
  </style>
</head>

<body class="text-white bg-[var(--sb-main-top)] min-h-screen flex flex-col md:flex-row">

  <!-- LEFT SIDEBAR -->
  <aside id="sidebar" class="sidebar hidden md:flex flex-col shrink-0 select-none" data-collapsed="false">
    <div class="brand-area border-b border-white/10 px-[16px] py-[20px]">
      <div class="brand-wrapper">
        <div id="brandToggleArea" class="brand-left">
          <div class="logo-wrapper"><img src="home_assets/logo.png" alt="FOR:WORD"/></div>
          <div class="expand-icon-wrapper">
            <svg class="w-[16px] h-[16px] text-white/80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><path d="m9 6 6 6-6 6"/></svg>
          </div>
          <div class="flex flex-col"><div class="brand-text">FOR:WORD</div></div>
        </div>
        <div class="brand-right">
          <div id="collapseToggle" class="collapse-btn tap-highlight-clear" aria-label="Collapse sidebar">
            <svg class="collapse-icon w-[16px] h-[16px] text-white/80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
          </div>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav-container text-sm">
      <a href="home.html" class="sidebar-nav-btn tap-highlight-clear mb-[4px] hover:bg-white/10">
        <img src="home_assets/Main_icon.svg" alt="Main" class="w-[20px] h-[20px] object-contain"/>
        <span class="nav-label">Main</span>
      </a>
      <a href="editor.html" class="sidebar-nav-btn tap-highlight-clear mb-[4px] hover:bg-white/10">
        <img src="home_assets/Editor_icon.svg" alt="Editor View" class="w-[20px] h-[20px] object-contain opacity-70"/>
        <span class="nav-label">Editor View</span>
      </a>
      <a href="projects-list.html" class="sidebar-nav-btn sidebar-nav-btn-active tap-highlight-clear mb-[4px] bg-white/10 hover:bg-white/15">
        <img src="home_assets/Project_icon.svg" alt="Projects" class="w-[20px] h-[20px] object-contain"/>
        <span class="nav-label nav-label-active">Projects</span>
      </a>
      <a href="graph.html" class="sidebar-nav-btn tap-highlight-clear mb-[16px] hover:bg-white/10">
        <img src="home_assets/Graph_icon.svg" alt="Knowledge Graph" class="w-[20px] h-[20px] object-contain opacity-70"/>
        <span class="nav-label">Knowledge Graph</span>
      </a>

      <div class="sidebar-divider"></div>

      <a href="social.html" class="sidebar-nav-btn tap-highlight-clear mb-[4px] hover:bg-white/10">
        <img src="home_assets/Social_icon.svg" alt="Social" class="w-[20px] h-[20px] object-contain opacity-70"/>
        <span class="nav-label">Social</span>
      </a>
    </nav>

    <div class="profile-border text-xs text-white/60">
      <div class="profile-wrap">
        <div class="profile-row">
          <div class="profile-icon"><img src="home_assets/Profile_icon.svg" alt="Profile"/></div>
          <div class="profile-meta">
            <span class="text-white/90 text-[13px] font-medium">hs r</span>
            <span class="text-white/50 text-[11px]">Workspace</span>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- MOBILE NAV -->
  <nav class="md:hidden fixed bottom-0 left-0 right-0 z-50 flex justify-around items-center border-t border-white/10 backdrop-blur-md mobile-nav-bg"
       style="height:var(--mobile-nav-h);">
    <a href="home.html" class="mobile-nav-btn">
      <img src="home_assets/Main_icon.svg" alt="Main" class="w-[24px] h-[24px] object-contain"/>
      <span>Main</span>
    </a>
    <a href="editor.html" class="mobile-nav-btn">
      <img src="home_assets/Editor_icon.svg" alt="Editor" class="w-[24px] h-[24px] object-contain"/>
      <span>Editor</span>
    </a>
    <a href="projects-list.html" class="mobile-nav-btn mobile-nav-btn-active">
      <img src="home_assets/Project_icon.svg" alt="Projects" class="w-[24px] h-[24px] object-contain"/>
      <span>Projects</span>
    </a>
    <a href="graph.html" class="mobile-nav-btn">
      <img src="home_assets/Graph_icon.svg" alt="Graph" class="w-[24px] h-[24px] object-contain opacity-70"/>
      <span>Graph</span>
    </a>
    <a href="social.html" class="mobile-nav-btn">
      <img src="home_assets/Social_icon.svg" alt="Social" class="w-[24px] h-[24px] object-contain"/>
      <span>Social</span>
    </a>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="flex-1 flex flex-col relative w-full min-h-screen md:min-h-0 md:h-screen overflow-hidden text-white main-bg">
    <section class="flex-1 overscroll-contain pb-[calc(var(--mobile-nav-h)+16px)] md:pb-[32px]"
             style="overflow-y:hidden; padding-top:15px; padding-left:20px; padding-right:32px;">
      <div class="page-inner">
        <section class="projects-wrapper" id="projectsWrapper">
          <!-- RIGHT -->
          <section class="right-region">
            <header class="right-header"><div class="hero-title">Projects</div></header>

            <section class="board-shell">
              <div class="projects-scroller" id="projectsScroll">
                <div class="projects-row" id="projectsRow"></div>
              </div>
            </section>
          </section>
        </section>
      </div>
    </section>
  </main>

  <script>
    /* ===== 고정: 리스트 전용 ===== */
    const VIEW = 'list';

    /* ===== Sidebar collapse/expand ===== */
    const sidebar = document.getElementById('sidebar');
    const collapseToggle = document.getElementById('collapseToggle');
    const brandToggleArea = document.getElementById('brandToggleArea');
    if(collapseToggle){
      collapseToggle.addEventListener('click', () => sidebar.setAttribute('data-collapsed', 'true'));
    }
    if(brandToggleArea){
      brandToggleArea.addEventListener('click', () => {
        if (sidebar.getAttribute('data-collapsed') === 'true') sidebar.setAttribute('data-collapsed', 'false');
      });
    }

    /* =========================================================
       엘리먼트 핸들 & 스토리지 키
    ========================================================= */
    const projectsScroll = document.getElementById('projectsScroll');
    const projectsRow   = document.getElementById('projectsRow');

    const DRAFT_KEY = 'fw_project_draft_v2';
    const LIST_KEY  = 'fw_projects';

    /* =========================================================
       유틸
    ========================================================= */
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }

    /* =========================================================
       리스트 렌더링/삭제/드래그
    ========================================================= */
    const dragState = { draggingId: null, isDragging: false, overEl: null };

    function renderProjectListCard(p){
      const card = document.createElement('div');
      card.className = 'proj-card list-card';
      card.setAttribute('data-card','');
      card.dataset.projectId = p.id;
      card.setAttribute('draggable','true');

      const delBtn = document.createElement('button');
      delBtn.className = 'card-del-btn';
      delBtn.type = 'button';
      delBtn.title = '삭제';
      delBtn.setAttribute('aria-label', '프로젝트 삭제');
      delBtn.textContent = 'x';
      delBtn.addEventListener('click', (ev)=>{
        ev.stopPropagation();
        deleteProject(p.id);
      });

      card.innerHTML = `
        <div class="proj-toprow">
          <div class="proj-texts">
            <div class="proj-title">${escapeHtml(p.title || '새 프로젝트')}</div>
            <div class="proj-duedate">
              <button type="button" class="due-btn ${p.dueDate ? 'filled' : ''}" style="pointer-events:none">
                ${p.dueDate ? 'Due Date: ' + escapeHtml(p.dueDate) : 'Due Date: 미지정'}
              </button>
            </div>
          </div>
          <div class="proj-iconwrap" title="클릭하여 이모지 설정" data-emoji="${p?.iconEmoji ? escapeHtml(p.iconEmoji) : ''}">
            ${p?.iconEmoji ? `<span class="emoji">${escapeHtml(p.iconEmoji)}</span>` : 'LOGO'}
          </div>
        </div>
        <div class="proj-status-row">
          <span class="proj-status-dot"></span><span class="proj-status-text">In Progress</span>
        </div>
        <div class="proj-progressbar"><div class="proj-progress-inner" style="width:0%"></div></div>
        <div class="proj-footer-row">
          <div class="proj-tasks-text"><span class="done-count">0</span>/<span class="total-count">${Number(p.totalTasks||0)}</span> Total Tasks</div>
          <div class="proj-percent"><span class="percent-val">0%</span></div>
        </div>
        <div class="proj-hint">저장됨: ${p.savedAt ? new Date(p.savedAt).toLocaleString() : '-'}</div>
      `;

      card.appendChild(delBtn);

      const iconEl = card.querySelector('.proj-iconwrap');
      iconEl.addEventListener('click', (e)=>{
        e.stopPropagation();
        promptAndSaveEmojiForProject(p.id, iconEl);
      });

      card.addEventListener('click', ()=>{
        if (dragState.isDragging) return;
        openProject(p.id);
      });

      card.addEventListener('dragstart', (e)=>{
        dragState.draggingId = p.id;
        dragState.isDragging = true;
        card.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', p.id);
      });
      card.addEventListener('dragend', ()=>{
        dragState.isDragging = false;
        dragState.draggingId = null;
        if (dragState.overEl){ dragState.overEl.classList.remove('drop-target'); dragState.overEl = null; }
        renderListView();
      });

      return card;
    }

    function renderListView(){
      const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
      projectsRow.innerHTML = '';

      if (list.length){
        list.forEach((p, i)=>{
          const card = renderProjectListCard(p);
          const col = (i % 4) + 1;
          const row = Math.floor(i / 4) + 1;
          card.style.gridColumn = String(col);
          card.style.gridRow = String(row);
          projectsRow.appendChild(card);
        });
      }

      const newCard = document.createElement('div');
      newCard.className = 'proj-card new-proj-card';
      newCard.setAttribute('data-card','');
      const nextIndex = list.length;
      const col = (nextIndex % 4) + 1;
      const row = Math.floor(nextIndex / 4) + 1;
      newCard.style.gridColumn = String(col);
      newCard.style.gridRow = String(row);
      newCard.innerHTML = `<div class="plus">＋</div><div class="label">새로운 프로젝트 만들기</div>`;
      newCard.addEventListener('click', newProject);
      projectsRow.appendChild(newCard);
    }

    function deleteProject(id){
      if (!confirm('이 프로젝트를 삭제할까요? 삭제 후 되돌릴 수 없습니다.')) return;
      const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
      const idx = list.findIndex(p => p.id === id);
      if (idx >= 0){
        list.splice(idx,1);
        localStorage.setItem(LIST_KEY, JSON.stringify(list));
        toast('삭제되었습니다');
      }
      renderListView();
    }

    projectsRow.addEventListener('dragover', (e)=>{
      if (!dragState.isDragging) return;
      e.preventDefault();
      const target = e.target.closest('.list-card');
      if (dragState.overEl && dragState.overEl !== target){
        dragState.overEl.classList.remove('drop-target');
      }
      if (target && target.dataset.projectId !== dragState.draggingId){
        target.classList.add('drop-target');
        dragState.overEl = target;
      }else{
        dragState.overEl = null;
      }
    });

    projectsRow.addEventListener('drop', (e)=>{
      if (!dragState.isDragging) return;
      e.preventDefault();

      const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
      const fromIdx = list.findIndex(p => p.id === dragState.draggingId);
      if (fromIdx < 0){ cleanupDnD(); return; }

      const targetCard = e.target.closest('.list-card');
      let toIdx;
      if (targetCard && targetCard.dataset.projectId !== dragState.draggingId){
        toIdx = list.findIndex(p => p.id === targetCard.dataset.projectId);
        if (toIdx < 0){ cleanupDnD(); return; }
      } else {
        toIdx = list.length - 1;
      }

      if (toIdx > fromIdx) toIdx--;
      if (toIdx === fromIdx){ cleanupDnD(); return; }

      const [moved] = list.splice(fromIdx, 1);
      list.splice(toIdx, 0, moved);
      localStorage.setItem(LIST_KEY, JSON.stringify(list));

      cleanupDnD();
      renderListView();
    });

    function cleanupDnD(){
      dragState.isDragging = false;
      dragState.draggingId = null;
      if (dragState.overEl){ dragState.overEl.classList.remove('drop-target'); dragState.overEl = null; }
    }

    function promptAndSaveEmojiForProject(id, iconEl){
      const input = prompt('이모지를 입력 (1글자). 비우면 LOGO로 돌아갑니다.', iconEl.getAttribute('data-emoji') || '');
      if (input === null) return;
      const emoji = Array.from(String(input).trim())[0];
      const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
      const idx = list.findIndex(p => p.id === id);
      if (idx >= 0){
        list[idx].iconEmoji = emoji || null;
        localStorage.setItem(LIST_KEY, JSON.stringify(list));
      }
      if (emoji){
        iconEl.setAttribute('data-emoji', emoji);
        iconEl.innerHTML = `<span class="emoji">${emoji}</span>`;
      } else {
        iconEl.removeAttribute('data-emoji');
        iconEl.textContent = 'LOGO';
      }
    }

    function toast(msg){
      const t = document.createElement('div');
      t.style.position='fixed';
      t.style.left='50%';
      t.style.transform='translateX(-50%)';
      t.style.bottom='24px';
      t.style.background='#111827';
      t.style.color='#fff';
      t.style.padding='10px 14px';
      t.style.borderRadius='10px';
      t.style.fontWeight='600';
      t.style.boxShadow='0 10px 30px rgba(0,0,0,0.25)';
      t.style.zIndex='9999';
      t.style.opacity='0';
      t.style.transition='opacity .18s ease, transform .18s ease';
      t.textContent = msg;
      document.body.appendChild(t);
      requestAnimationFrame(()=> { t.style.opacity='1'; t.style.transform='translateX(-50%) translateY(-4px)'; });
      setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=> t.remove(), 180); }, 1600);
    }

    /* ===== 라우팅 ===== */
    function newProject(){
      try{ localStorage.removeItem(DRAFT_KEY); }catch(e){}
      window.__fw_draft_id = null;
      location.href = 'projects-create-1.html?new=1';
    }
    function openProject(projectId){
      const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
      const found = list.find(p => p.id === projectId) || null;
      if (found){
        try{ localStorage.setItem(DRAFT_KEY, JSON.stringify(found)); }catch(e){}
        window.__fw_draft_id = found.id;
      }
      location.href = 'projects-create-1.html';
    }

    /* ===== 부팅 ===== */
    window.addEventListener('load', renderListView);
  </script>
</body>
</html>
