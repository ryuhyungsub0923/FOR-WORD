<!doctype html>
<html lang="ko" class="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FOR:WORD â€” Editor View</title>

  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css"/>

  <!-- Tailwind (dev only) -->
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Pretendard','system-ui','sans-serif'] }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>

  <style>
    :root{
      /* ===== ë¸Œëœë“œ ë„¤ë¹„(ìœ ì§€) ===== */
      --sb-nav-top: rgba(30,31,31,0.9);
      --sb-nav-bottom: #848C95;

      /* ===== ì‘ì—…ì˜ì—­ í† í° ===== */
      --canvas-bg: #FFFFFF;
      --work-bg: #F7F7F8;
      --ink-1: #111827;
      --ink-2: #6B7280;
      --divider: #E5E7EB;

      --sidebar-w: 212px;
      --sidebar-w-collapsed: 68px;

      /* ì¢Œì¸¡ INDEX, ìš°ì¸¡ íŒ¨ë„ í­ */
      --index-w: 280px;
      --right-w: 360px;

      --editor-min-h: 520px;
    }

    body{ overflow:hidden; color:var(--ink-1); }

    /* ---------------- ë„¤ë¹„ê²Œì´ì…˜(ê·¸ëŒ€ë¡œ) ---------------- */
    .sidebar{
      width:var(--sidebar-w);
      background: linear-gradient(to bottom, var(--sb-nav-top) 0%, var(--sb-nav-bottom) 100%);
      transition: width .18s ease;
    }
    .sidebar[data-collapsed="true"]{ width:var(--sidebar-w-collapsed); }
    .sidebar-nav-btn{ width:180px; height:48px; display:flex; align-items:center; gap:10px; border-radius:8px; padding:0 12px; text-decoration:none; color:inherit; }
    .sidebar[data-collapsed="true"] .sidebar-nav-btn{ width:48px; padding:0; justify-content:center; gap:0; }
    .nav-label{ font-size:14px; color:rgba(255,255,255,.75); }
    .nav-label-active{ color:#fff; font-weight:600; }
    .sidebar-divider{ width:100%; border-top:1px solid rgba(255,255,255,.15); margin:16px 0; }

    /* ---------------- ì¢Œì¸¡ INDEX(ê³ ì • ìœ ì§€) ---------------- */
    #outlineCol{
      width:var(--index-w);
      background:#101214;
      color:#F3F4F6;
      display:flex; flex-direction:column;
      border-right:1px solid rgba(255,255,255,.08);
    }
    .index-head{ height:48px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid rgba(255,255,255,.08); }
    .index-title{ font-size:14px; font-weight:700; letter-spacing:-0.01em; }
    .index-back{ width:28px; height:28px; border-radius:6px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); cursor:pointer; }
    .index-scroll{ flex:1; overflow:auto; padding:8px 8px 12px 8px; }
    .tree{ font-size:13px; line-height:1.5; }
    .tree ul{ margin:6px 0; padding-left:12px; border-left:1px dashed rgba(255,255,255,.12); }
    .tree-li{ margin:4px 0; color:#E5E7EB; }
    .tree-li .label{ display:inline-flex; align-items:center; gap:6px; }
    .tree-li .bullet{ width:6px; height:6px; border-radius:999px; background:#9CA3AF; opacity:.8; }
    .tree-li.active{ background:#181B1F; border:1px solid rgba(255,255,255,.08); border-left:3px solid #7DD3FC; border-radius:6px; padding:4px 6px; color:#fff; }

    /* ---------------- ì¤‘ì•™ íŒ¨ë„(ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼) ---------------- */
    .center-wrap{ flex:1 1 auto; min-width:0; background:var(--canvas-bg); display:flex; flex-direction:column; }
    /* ìƒë‹¨ íƒ€ì´í‹€ ë°” */
    .doc-topbar{
      height:44px; display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--divider); padding:0 14px;
      background:var(--canvas-bg);
      position:sticky; top:0; z-index:5;
    }
    .doc-title{
      font-size:14px; color:#9CA3AF; outline:none; border:none; background:transparent; width:40%;
    }
    .doc-actions{ display:flex; align-items:center; gap:14px; font-size:12px; color:#374151; }
    .chip{ font-size:12px; padding:4px 8px; border-radius:999px; background:#111827; color:#fff; }
    .link-like{ cursor:pointer; }
    /* íƒœê·¸ + íˆ´ë°” ë°” */
    .toolbar-wrap{ border-bottom:1px solid var(--divider); background:#F9FAFB; }
    .tag-row{ height:40px; display:flex; align-items:center; gap:8px; padding:0 12px; }
    .tag-add{ font-size:12px; border:1px solid #E5E7EB; background:#fff; padding:6px 10px; border-radius:999px; cursor:pointer; color:#374151; }
    .toolbar-row{ display:flex; align-items:center; gap:10px; padding:10px 12px; }
    .tbtn{
      height:28px; min-width:28px; padding:0 8px; border-radius:6px; border:1px solid #D1D5DB; background:#fff;
      display:flex; align-items:center; justify-content:center; gap:6px; font-size:13px; cursor:pointer; color:#111827;
    }
    .tsep{ height:28px; width:1px; background:#E5E7EB; margin:0 2px; }

    /* ì—ë””í„° ë³¸ë¬¸ */
    .editor-area{
      flex:1 1 auto; min-height:var(--editor-min-h);
      padding:16px; outline:none; font-size:14px; line-height:1.8; color:#111827;
      white-space:pre-wrap; word-break:break-word;
    }
    .editor-area:empty:before{
      content:'í´ë¦­í•˜ì—¬ ë…¸íŠ¸ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”! ì˜¤ë¥¸ìª½ ë©”ëª¨ íƒ­ì—ì„œ ë©”ëª¨ë¥¼ ë“œë˜ê·¸í•´ì„œ ì—¬ê¸°ì— ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      color:#9CA3AF;
    }
    /* í•˜ë‹¨ ë°” */
    .editor-footer{
      border-top:1px solid var(--divider); height:44px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; background:#fff;
      position:sticky; bottom:0; z-index:2;
    }
    .icon-btn{ width:28px; height:28px; border-radius:6px; border:1px solid #E5E7EB; display:flex; align-items:center; justify-content:center; background:#fff; }

    /* ---------------- ìš°ì¸¡ íŒ¨ë„(ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼) ---------------- */
    .right-col{
      width:var(--right-w); background:#FAFAFB; display:flex; flex-direction:column; height:100vh;
      border-left:2px dotted #60A5FA;          /* ì´ë¯¸ì§€ì˜ ì ì„  êµ¬ë¶„ ëŠë‚Œ */
    }
    .tabs{
      height:44px; display:flex; align-items:center; gap:8px; padding:0 10px; border-bottom:1px solid var(--divider); background:#FFFFFF;
    }
    .tab{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:8px; font-weight:600; font-size:13px; color:#374151; cursor:pointer;
    }
    .tab[aria-selected="true"]{ background:#F3F4F6; }
    .panel{ display:none; height:calc(100vh - 44px); }
    .panel[data-active="true"]{ display:flex; flex-direction:column; }

    /* ì±—ë´‡ */
    .chat-log{ flex:1 1 auto; overflow:auto; padding:12px; }
    .bubble{ max-width:85%; border-radius:10px; padding:10px 12px; font-size:13px; line-height:1.55; }
    .bot{ background:#FFFFFF; border:1px solid #E5E7EB; color:#111827; margin-right:auto; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .me{ background:#111827; color:#fff; margin-left:auto; }
    .chat-bar{ border-top:1px solid var(--divider); background:#fff; padding:10px; display:flex; gap:8px; }
    .chat-input{ flex:1; border:1px solid #D1D5DB; border-radius:12px; padding:10px 12px; font-size:13px; }
    .send-btn{ width:36px; height:36px; border-radius:10px; background:#111827; color:#fff; display:flex; align-items:center; justify-content:center; }

    /* ë©”ëª¨ */
    .memo-wrap{ flex:1; display:flex; flex-direction:column; }
    .memo-list{ flex:1; overflow:auto; padding:12px; }
    .memo-card{ background:#fff; border:1px solid #E5E7EB; border-radius:8px; padding:10px 12px; font-size:13px; color:#374151; margin-bottom:8px; }
    .memo-bar{ border-top:1px solid var(--divider); padding:10px; background:#fff; display:flex; gap:8px; }
    .memo-input{ flex:1; border:1px solid #D1D5DB; border-radius:10px; padding:10px 12px; font-size:13px; }

    /* ì¶”ì²œ */
    .reco-wrap{ flex:1; overflow:auto; padding:12px; }
    .reco-card{ background:#fff; border:1px solid #E5E7EB; border-radius:8px; padding:12px; margin-bottom:8px; }
    .reco-title{ font-weight:700; font-size:13px; margin-bottom:4px; }
    .reco-sub{ font-size:12px; color:#4B5563; }
  </style>
</head>

<body class="font-sans min-h-screen flex flex-row">

  <!-- ================== LEFT NAV (ìœ ì§€) ================== -->
  <aside id="sidebar" class="sidebar hidden md:flex flex-col shrink-0 select-none" data-collapsed="false">
    <div class="brand-area border-b border-white/10 px-[16px] py-[20px]">
      <div class="flex items-center justify-between">
        <div id="brandToggleArea" class="flex items-center gap-3 cursor-pointer">
          <div class="w-8 h-8 rounded-md bg-white/10 border border-white/20 flex items-center justify-center overflow-hidden">
            <img src="home_assets/logo.png" alt="FOR:WORD" class="w-full h-full object-contain"/>
          </div>
          <div class="hidden items-center justify-center w-8 h-8 rounded-md bg-white/10 border border-white/15 expand-icon-wrapper">
            <svg class="w-4 h-4 text-white/80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="m9 6 6 6-6 6"/></svg>
          </div>
          <div class="brand-text text-white font-semibold">FOR:WORD</div>
        </div>
        <button id="collapseToggle" class="w-7 h-7 rounded-md bg-white/10 border border-white/15 flex items-center justify-center">
          <svg class="w-4 h-4 text-white/80" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
      </div>
    </div>

    <nav class="sidebar-nav-container flex-1 text-sm px-4">
      <a href="home.html" class="sidebar-nav-btn hover:bg-white/10 mb-1">
        <img src="home_assets/Main_icon.svg" class="w-5 h-5" alt="Main"/><span class="nav-label">Main</span>
      </a>
      <a href="editor.html" class="sidebar-nav-btn bg-white/10 hover:bg-white/15 mb-1">
        <img src="home_assets/Editor_icon.svg" class="w-5 h-5" alt="Editor"/><span class="nav-label nav-label-active">Editor View</span>
      </a>
      <a href="projects.html" class="sidebar-nav-btn hover:bg-white/10 mb-1">
        <img src="home_assets/Project_icon.svg" class="w-5 h-5 opacity-70" alt="Projects"/><span class="nav-label">Projects</span>
      </a>
      <a href="graph.html" class="sidebar-nav-btn hover:bg-white/10 mb-4">
        <img src="home_assets/Graph_icon.svg" class="w-5 h-5 opacity-70" alt="Graph"/><span class="nav-label">Knowledge Graph</span>
      </a>
      <div class="sidebar-divider"></div>
      <a href="social.html" class="sidebar-nav-btn hover:bg-white/10 mb-1">
        <img src="home_assets/Social_icon.svg" class="w-5 h-5 opacity-70" alt="Social"/><span class="nav-label">Social</span>
      </a>
    </nav>

    <div class="border-t border-white/10 px-4 py-4 text-white/70 text-xs">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-md bg-white/10 border border-white/20 flex items-center justify-center overflow-hidden">
          <img src="home_assets/Profile_icon.svg" alt="Profile" class="w-full h-full object-contain"/>
        </div>
        <div class="leading-tight">
          <div class="text-white text-[13px] font-medium">hs r</div>
          <div class="text-white/60 text-[11px]">Workspace</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ================== LEFT INDEX ================== -->
  <aside id="outlineCol" class="hidden md:flex flex-col shrink-0">
    <div class="index-head">
      <div class="index-title">INDEX</div>
      <div id="indexBack" class="index-back" title="ë’¤ë¡œ">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </div>
    </div>
    <div class="index-scroll">
      <div id="indexTree" class="tree"><!-- JS ë Œë” --></div>
    </div>
  </aside>

  <!-- ================== CENTER (ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼) ================== -->
  <main class="center-wrap">
    <!-- ìƒë‹¨ íƒ€ì´í‹€ ë°” -->
    <div class="doc-topbar">
      <input id="docTitle" class="doc-title" placeholder="write title" />
      <div class="doc-actions">
        <span class="link-like">ìŠ¤í”Œë¦¿ ë·° <span class="chip">ON</span></span>
        <span class="link-like">ì €ì¥</span>
      </div>
    </div>

    <!-- íƒœê·¸ + íˆ´ë°” -->
    <div class="toolbar-wrap">
      <div class="tag-row">
        <button class="tag-add">+ íƒœê·¸ ì¶”ê°€</button>
      </div>
      <div class="toolbar-row">
        <button class="tbtn" title="Bold">B</button>
        <button class="tbtn" title="Italic">I</button>
        <button class="tbtn" title="Underline">U</button>
        <div class="tsep"></div>
        <button class="tbtn" title="Left">âŸ¸</button>
        <button class="tbtn" title="Center">â†”</button>
        <button class="tbtn" title="Right">âŸ¹</button>
        <div class="tsep"></div>
        <button class="tbtn" title="Bulleted">â€¢</button>
        <button class="tbtn" title="Numbered">1.</button>
        <div class="tsep"></div>
        <button class="tbtn" title="Code">&lt;&gt;</button>
        <button class="tbtn" title="Link">ğŸ”—</button>
        <button class="tbtn" title="Image">ğŸ–¼ï¸</button>
        <button class="tbtn" title="ìº”ë²„ìŠ¤">ğŸ§© ìº”ë²„ìŠ¤</button>
      </div>
    </div>

    <!-- ì—ë””í„° -->
    <div id="editorArea" class="editor-area" contenteditable="true"></div>

    <!-- í•˜ë‹¨ ë°” -->
    <div class="editor-footer">
      <div class="flex items-center gap-2">
        <button class="icon-btn" title="ì¦ê²¨ì°¾ê¸°">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
        </button>
        <button class="icon-btn" title="ì²¨ë¶€">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M21.44 11.05l-9.19 9.19a5 5 0 01-7.07-7.07l9.19-9.19a3 3 0 014.24 4.24l-9.2 9.19a1 1 0 01-1.41-1.41l8.49-8.49"/></svg>
        </button>
      </div>
      <button class="icon-btn" title="ë³´ë‚´ê¸°">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
      </button>
    </div>
  </main>

  <!-- ================== RIGHT (ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼) ================== -->
  <aside class="right-col">
    <div class="tabs">
      <button id="tab-chat" class="tab" aria-selected="true" aria-controls="panel-chat">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M21 15a4 4 0 01-4 4H7l-4 4V7a4 4 0 014-4h10a4 4 0 014 4z"/></svg>
        <span>ì±—ë´‡</span>
      </button>
      <button id="tab-memo" class="tab" aria-selected="false" aria-controls="panel-memo">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M9 12h6M9 16h6M8 4h8a2 2 0 012 2v12l-4 4H8a2 2 0 01-2-2V6a2 2 0 012-2z"/></svg>
        <span>ë©”ëª¨</span>
      </button>
      <button id="tab-reco" class="tab" aria-selected="false" aria-controls="panel-reco">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="1.5"><path d="M12 2l3 7 7 .5-5 5 1.5 7L12 18 5.5 21 7 14 2 9.5 9 9z"/></svg>
        <span>ì¶”ì²œ</span>
      </button>
    </div>

    <!-- ì±—ë´‡ -->
    <section id="panel-chat" class="panel" data-active="true" role="tabpanel">
      <div class="chat-log" id="chatLog">
        <div class="bubble bot">ì•ˆë…•í•˜ì„¸ìš”! ë…¸íŠ¸ ì‘ì„±ì„ ë„ì™€ë“œë¦¬ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
      </div>
      <div class="chat-bar">
        <input id="chatInput" class="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."/>
        <button id="chatSend" class="send-btn" title="ì „ì†¡">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
        </button>
      </div>
    </section>

    <!-- ë©”ëª¨ -->
    <section id="panel-memo" class="panel" role="tabpanel">
      <div class="memo-wrap">
        <div id="memoList" class="memo-list"></div>
        <div class="memo-bar">
          <input id="memoInput" class="memo-input" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ê³  Enter"/>
          <button id="memoAdd" class="send-btn" title="ì¶”ê°€">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5"><path d="M12 5v14M5 12h14"/></svg>
          </button>
        </div>
      </div>
    </section>

    <!-- ì¶”ì²œ -->
    <section id="panel-reco" class="panel" role="tabpanel">
      <div id="recoWrap" class="reco-wrap">
        <div class="reco-card">
          <div class="reco-title">ë„ë§ì—ì„œì˜ ë‚™ì›</div>
          <div class="reco-sub">ë„ë§ì¹œ ê³³ì— ë‚™ì›ì€ ì—†ë‹¤ì§€ë§Œ ë‚˜ëŠ” ë„ë§ì³¤ê³ , ê·¸ ê³³ì€ ì˜ˆìƒì¹˜ ëª»í•œ ë‚™ì›ì´ì—ˆë‹¤.</div>
        </div>
      </div>
    </section>
  </aside>

  <script>
    /* ===== ë„¤ë¹„ í† ê¸€(ìœ ì§€) ===== */
    const sidebar = document.getElementById('sidebar');
    document.getElementById('collapseToggle')?.addEventListener('click',()=> sidebar.setAttribute('data-collapsed','true'));
    document.getElementById('brandToggleArea')?.addEventListener('click',()=>{ if (sidebar.getAttribute('data-collapsed')==='true') sidebar.setAttribute('data-collapsed','false'); });

    /* ===== í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ ===== */
    (function(){
      const LIST_KEY = 'fw_projects';
      const DRAFT_KEY = 'fw_project_draft_v2';

      const qs = new URLSearchParams(location.search);
      const projectId = (qs.get('projectId') || '').trim();

      function loadProject(){
        const list = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
        let p = null;
        if (projectId){ p = list.find(x => x && x.id === projectId) || null; }
        if (!p){
          try{ const d = JSON.parse(localStorage.getItem(DRAFT_KEY) || 'null'); if (d && typeof d === 'object') p = d; }catch(e){}
        }
        return p;
      }

      /* ----- ì¢Œì¸¡ INDEX ë Œë” ----- */
      function textNode(s){ return document.createTextNode(String(s ?? '')); }
      function el(tag, attrs={}, children=[]){
        const n = document.createElement(tag);
        for (const k in attrs){ if (k==='class') n.className = attrs[k]; else n.setAttribute(k, attrs[k]); }
        (Array.isArray(children)?children:[children]).forEach(c=>{
          if (c==null) return;
          if (typeof c==='string' || typeof c==='number') n.appendChild(textNode(c)); else n.appendChild(c);
        });
        return n;
      }
      function renderIndexTree(p){
        const root = document.getElementById('indexTree');
        root.innerHTML = '';
        if(!p){ root.appendChild(el('div',{class:'text-sm text-gray-400'},'í”„ë¡œì íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')); return; }

        const title = p.title || 'í”„ë¡œì íŠ¸ ì •ì˜ì„œ';
        root.appendChild(el('div',{class:'tree-li active'}, el('span',{class:'label'}, [el('span',{class:'bullet'}),' ', title])));

        const ulRoot = el('ul');

        const li1 = el('li',{class:'tree-li'});
        li1.appendChild(el('span',{class:'label'},[el('span',{class:'bullet'}),' 1. ê°œìš”']));
        const ul1 = el('ul');
        ul1.appendChild(el('li',{class:'tree-li'}, (p.background||'â€”')));
        li1.appendChild(ul1);
        ulRoot.appendChild(li1);

        const epics = Array.isArray(p.epics)? p.epics : [];
        epics.forEach((ep, ei)=>{
          const liE = el('li',{class:'tree-li'});
          liE.appendChild(el('span',{class:'label'},[el('span',{class:'bullet'}),` EPIC ${ei+1}: ${ep?.epic?.trim()||'â€”'}`]));
          const ulE = el('ul');
          ulE.appendChild(el('li',{class:'tree-li'}, `objective: ${ (ep?.object||'â€”') }`));

          const krs = Array.isArray(ep?.krs)? ep.krs : [];
          const tbk = Array.isArray(ep?.tasksByKr)? ep.tasksByKr : [];
          krs.forEach((kr, ki)=>{
            const liKr = el('li',{class:'tree-li'});
            liKr.appendChild(el('span',{class:'label'},[el('span',{class:'bullet'}),` KR${ki+1}: ${kr||'â€”'}`]));
            const ulKr = el('ul');
            (Array.isArray(tbk[ki])? tbk[ki] : []).forEach((t,ti)=> ulKr.appendChild(el('li',{class:'tree-li'},`task${ti+1}: ${t}`)));
            if (!Array.isArray(tbk[ki]) || !tbk[ki].length) ulKr.appendChild(el('li',{class:'tree-li text-gray-400'},'task: â€”'));
            liKr.appendChild(ulKr);
            ulE.appendChild(liKr);
          });

          liE.appendChild(ulE);
          ulRoot.appendChild(liE);
        });

        root.appendChild(ulRoot);
      }

      /* ----- ìš°ì¸¡ ì¶”ì²œ ì¹´ë“œ ìƒ˜í”Œ ----- */
      function renderRecommendations(p){
        const wrap = document.getElementById('recoWrap');
        if(!p) return;
        const items = [];
        if (p.dueDate || p.totalTasks) items.push({t:'ì¼ì • ê°œìš”', s:`Due: ${p.dueDate||'â€”'} Â· ì´ Tasks: ${Number(p.totalTasks||0)}`});
        const epics = Array.isArray(p.epics)? p.epics : [];
        let gaps = [];
        epics.forEach((ep, ei)=>{
          const krs = Array.isArray(ep?.krs)? ep.krs: [];
          const tbk = Array.isArray(ep?.tasksByKr)? ep.tasksByKr : [];
          krs.forEach((kr, ki)=>{
            const tasks = Array.isArray(tbk[ki])? tbk[ki] : [];
            if (!tasks.length) gaps.push(`E${ei+1}-KR${ki+1}`);
          });
        });
        if (gaps.length) items.push({t:'Task ì±„ì›Œì•¼ í•  KR', s:gaps.slice(0,6).join(' Â· ') + (gaps.length>6?` ì™¸ ${gaps.length-6}`:'')});

        items.forEach(it=>{
          const card = document.createElement('div');
          card.className='reco-card';
          card.innerHTML = `<div class="reco-title">${it.t}</div><div class="reco-sub">${it.s}</div>`;
          wrap.appendChild(card);
        });
      }

      /* ----- íƒ­, ì±—, ë©”ëª¨ ----- */
      function tabsInit(){
        const tabs = [
          {btn: document.getElementById('tab-chat'), panel: document.getElementById('panel-chat')},
          {btn: document.getElementById('tab-memo'), panel: document.getElementById('panel-memo')},
          {btn: document.getElementById('tab-reco'), panel: document.getElementById('panel-reco')}
        ];
        function act(i){
          tabs.forEach((t,idx)=>{
            t.btn.setAttribute('aria-selected', idx===i ? 'true':'false');
            t.panel.setAttribute('data-active', idx===i ? 'true':'false');
          });
        }
        tabs.forEach((t,i)=> t.btn.onclick = ()=> act(i));
        act(0);
      }
      function chatInit(){
        const input = document.getElementById('chatInput');
        const send = document.getElementById('chatSend');
        const log  = document.getElementById('chatLog');
        function push(role, text){
          const b = document.createElement('div');
          b.className = 'bubble ' + (role==='me'?'me':'bot');
          b.textContent = text;
          log.appendChild(b);
          log.scrollTop = log.scrollHeight;
        }
        function sendNow(){
          const v = input.value.trim(); if(!v) return;
          push('me', v); input.value='';
          setTimeout(()=> push('bot','ë©”ëª¨í•´ë‘˜ê²Œìš”.'), 200);
        }
        send.onclick = sendNow;
        input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendNow(); } });
      }
      function memoInit(){
        const list = document.getElementById('memoList');
        const input = document.getElementById('memoInput');
        const add = document.getElementById('memoAdd');
        const KEY = 'fw_editor_memo_list';
        function render(){
          list.innerHTML='';
          const arr = JSON.parse(localStorage.getItem(KEY) || '[]');
          arr.forEach(t=>{
            const d = document.createElement('div');
            d.className='memo-card'; d.textContent = t;
            list.appendChild(d);
          });
        }
        function addNow(){
          const v = input.value.trim(); if(!v) return;
          const arr = JSON.parse(localStorage.getItem(KEY) || '[]'); arr.push(v);
          localStorage.setItem(KEY, JSON.stringify(arr)); input.value=''; render();
        }
        add.onclick = addNow;
        input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); addNow(); }});
        render();
      }

      const project = loadProject();
      renderIndexTree(project);
      renderRecommendations(project);
      tabsInit(); chatInit(); memoInit();
    })();

    document.getElementById('indexBack')?.addEventListener('click', ()=> alert('ë’¤ë¡œ ë™ì‘ì„ ì—°ê²°í•˜ì„¸ìš” (ì˜ˆ: history.back())'));
  </script>
</body>
</html>
